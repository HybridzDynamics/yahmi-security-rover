<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detections - Surveillance Car</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-shield-alt"></i>
            <span>Surveillance Car</span>
        </div>
        <div class="nav-menu">
            <a href="index.html" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="wifi-config.html" class="nav-link"><i class="fas fa-wifi"></i> WiFi Config</a>
            <a href="settings.html" class="nav-link"><i class="fas fa-cog"></i> Settings</a>
            <a href="logs.html" class="nav-link"><i class="fas fa-file-alt"></i> Logs</a>
            <a href="map.html" class="nav-link"><i class="fas fa-map"></i> Map</a>
            <a href="detections.html" class="nav-link active"><i class="fas fa-eye"></i> Detections</a>
        </div>
    </nav>

    <main class="main-content">
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-eye"></i> AI Detections</h2>
                <div>
                    <button id="refreshBtn" class="btn btn-secondary"><i class="fas fa-sync"></i> Refresh</button>
                </div>
            </div>
            <div id="detectionsContainer" class="card-list"></div>
        </section>
    </main>

    <script>
    async function fetchDetections() {
        try {
            const res = await fetch('/api/detections?limit=50');
            const list = await res.json();
            renderDetections(Array.isArray(list) ? list : []);
        } catch (e) {
            console.error('Failed to fetch detections', e);
        }
    }

    function renderDetections(items) {
        const c = document.getElementById('detectionsContainer');
        if (!items.length) {
            c.innerHTML = '<div class="empty">No detections yet.</div>';
            return;
        }
        c.innerHTML = items.map(d => {
            const ts = new Date(d.timestamp || d.createdAt || Date.now()).toLocaleString();
            const objs = (d.detectedObjects || d.detected_objects || []).join(', ') || 'unknown';
            const conf = typeof d.confidence === 'number' ? d.confidence.toFixed(2) : 'n/a';
            const level = d.alertLevel || d.alert_level || 'medium';
            const img = d.imageData ? `<img class="thumb" src="data:image/jpeg;base64,${d.imageData}" alt="detection"/>` : '';
            return `
            <div class="card detection-card">
                <div class="card-body">
                    <div class="card-row">
                        <div>
                            <div class="card-title">${objs}</div>
                            <div class="card-sub">${ts}</div>
                        </div>
                        <div class="pill pill-${level}">${level}</div>
                    </div>
                    <div class="card-row">
                        <div>Confidence: <strong>${conf}</strong></div>
                    </div>
                    ${img}
                    ${d.description ? `<div class="desc">${d.description}</div>` : ''}
                </div>
            </div>`;
        }).join('');
    }

    document.getElementById('refreshBtn').addEventListener('click', fetchDetections);
    fetchDetections();
    </script>
</body>
<!-- Minimal styles leveraging existing CSS utility classes -->
</html>


