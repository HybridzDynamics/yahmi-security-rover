<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs - Surveillance Car</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-shield-alt"></i>
            <span>Surveillance Car</span>
        </div>
        <div class="nav-menu">
            <a href="index.html" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="wifi-config.html" class="nav-link"><i class="fas fa-wifi"></i> WiFi Config</a>
            <a href="settings.html" class="nav-link"><i class="fas fa-cog"></i> Settings</a>
            <a href="logs.html" class="nav-link active"><i class="fas fa-file-alt"></i> Logs</a>
            <a href="map.html" class="nav-link"><i class="fas fa-map"></i> Map</a>
            <a href="detections.html" class="nav-link"><i class="fas fa-eye"></i> Detections</a>
        </div>
    </nav>

    <main class="main-content">
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-file-alt"></i> System Logs</h2>
                <div>
                    <button id="refreshBtn" class="btn btn-secondary"><i class="fas fa-sync"></i> Refresh</button>
                </div>
            </div>
            <div id="health" class="card">
                <div class="card-body">
                    <div class="card-row"><div class="card-title"><i class="fas fa-heartbeat"></i> Health</div></div>
                    <pre id="healthJson" class="pre"></pre>
                </div>
            </div>
            <div id="events" class="card">
                <div class="card-body">
                    <div class="card-row"><div class="card-title"><i class="fas fa-list"></i> Recent Events</div></div>
                    <div id="eventsList" class="log-list"></div>
                </div>
            </div>
        </section>
    </main>

    <script>
    async function fetchHealth() {
        const res = await fetch('/api/health');
        const data = await res.json();
        document.getElementById('healthJson').textContent = JSON.stringify(data, null, 2);
    }
    async function fetchEvents() {
        const res = await fetch('/api/events?limit=100');
        const events = await res.json();
        const list = document.getElementById('eventsList');
        list.innerHTML = (events || []).map(ev => {
            const ts = new Date(ev.timestamp || ev.createdAt || Date.now()).toLocaleString();
            const sev = ev.severity || 'medium';
            const type = ev.eventType || 'info';
            return `<div class="log-item">
                <div class="log-row">
                    <div class="pill pill-${sev}">${sev}</div>
                    <div class="log-type">${type}</div>
                    <div class="log-time">${ts}</div>
                </div>
                <div class="log-message">${ev.message || ''}</div>
                ${ev.component ? `<div class="log-component">Component: ${ev.component}</div>` : ''}
            </div>`;
        }).join('');
    }
    function refresh() { fetchHealth(); fetchEvents(); }
    document.getElementById('refreshBtn').addEventListener('click', refresh);
    refresh();
    </script>
</body>
</html>


