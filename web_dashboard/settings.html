<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Surveillance Car</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-shield-alt"></i>
            <span>Surveillance Car</span>
        </div>
        <div class="nav-menu">
            <a href="index.html" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="wifi-config.html" class="nav-link"><i class="fas fa-wifi"></i> WiFi Config</a>
            <a href="settings.html" class="nav-link active"><i class="fas fa-cog"></i> Settings</a>
            <a href="logs.html" class="nav-link"><i class="fas fa-file-alt"></i> Logs</a>
            <a href="map.html" class="nav-link"><i class="fas fa-map"></i> Map</a>
            <a href="detections.html" class="nav-link"><i class="fas fa-eye"></i> Detections</a>
        </div>
    </nav>

    <main class="main-content">
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-cog"></i> Configuration</h2>
                <div>
                    <button id="refreshBtn" class="btn btn-secondary"><i class="fas fa-sync"></i> Refresh</button>
                    <button id="saveBtn" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>
                </div>
            </div>
            <div class="grid-2">
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">Device</div>
                        <div class="form-group">
                            <label>Device Type</label>
                            <select id="deviceType">
                                <option value="esp32">ESP32</option>
                                <option value="raspberry_pi">Raspberry Pi</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Device IP</label>
                            <input id="deviceIp" type="text" placeholder="192.168.1.100">
                        </div>
                        <div class="form-group">
                            <label>Device Port</label>
                            <input id="devicePort" type="number" placeholder="80">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">Camera</div>
                        <div class="form-group">
                            <label>Quality</label>
                            <input id="cameraQuality" type="number" min="0" max="63">
                        </div>
                        <div class="form-group">
                            <label>Resolution</label>
                            <input id="cameraResolution" type="text" placeholder="640x480">
                        </div>
                        <div class="form-group">
                            <label>FPS</label>
                            <input id="cameraFps" type="number" min="1" max="60">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">AI</div>
                        <div class="form-group">
                            <label>Enable AI</label>
                            <input id="aiEnabled" type="checkbox">
                        </div>
                        <div class="form-group">
                            <label>Sensitivity</label>
                            <select id="aiSensitivity">
                                <option value="low">low</option>
                                <option value="medium">medium</option>
                                <option value="high">high</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">System</div>
                        <div class="form-group">
                            <label>Battery Threshold (%)</label>
                            <input id="batteryThreshold" type="number" min="0" max="100">
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
    function setVal(id, v) { const el = document.getElementById(id); if (el == null) return; if (el.type === 'checkbox') el.checked = !!v; else el.value = v ?? ''; }
    function getVal(id) { const el = document.getElementById(id); if (el == null) return undefined; return el.type === 'checkbox' ? el.checked : el.value; }

    async function loadConfig() {
        const res = await fetch('/api/config');
        const cfg = await res.json();
        setVal('deviceType', cfg.device_type || cfg.DEFAULT_DEVICE_TYPE || 'esp32');
        setVal('deviceIp', cfg.device_ip || cfg.DEFAULT_DEVICE_IP || '192.168.1.100');
        setVal('devicePort', cfg.device_port || cfg.DEFAULT_DEVICE_PORT || 80);
        setVal('cameraQuality', cfg.camera_quality || cfg.CAMERA_QUALITY || 12);
        setVal('cameraResolution', cfg.CAMERA_RESOLUTION || '640x480');
        setVal('cameraFps', cfg.CAMERA_FPS || 30);
        setVal('aiEnabled', cfg.ai_enabled ?? (cfg.AI_DETECTION_ENABLED ?? true));
        setVal('aiSensitivity', cfg.AI_SENSITIVITY || 'medium');
        setVal('batteryThreshold', cfg.battery_threshold || 20);
    }

    async function saveConfig() {
        const updates = [
            { name: 'device_type', value: getVal('deviceType'), type: 'string', category: 'system' },
            { name: 'device_ip', value: getVal('deviceIp'), type: 'string', category: 'network' },
            { name: 'device_port', value: Number(getVal('devicePort')), type: 'number', category: 'network' },
            { name: 'camera_quality', value: Number(getVal('cameraQuality')), type: 'number', category: 'camera' },
            { name: 'CAMERA_RESOLUTION', value: getVal('cameraResolution'), type: 'string', category: 'camera' },
            { name: 'CAMERA_FPS', value: Number(getVal('cameraFps')), type: 'number', category: 'camera' },
            { name: 'ai_enabled', value: !!getVal('aiEnabled'), type: 'boolean', category: 'ai' },
            { name: 'AI_SENSITIVITY', value: getVal('aiSensitivity'), type: 'string', category: 'ai' },
            { name: 'battery_threshold', value: Number(getVal('batteryThreshold')), type: 'number', category: 'system' }
        ];
        for (const u of updates) {
            await fetch('/api/config', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(u) });
        }
        alert('Configuration saved');
    }

    document.getElementById('refreshBtn').addEventListener('click', loadConfig);
    document.getElementById('saveBtn').addEventListener('click', saveConfig);
    loadConfig();
    </script>
</body>
</html>


